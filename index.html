<!DOCTYPE HTML>
<html lang="em">
<head>
<meta charset="UTF-8">

<link rel="stylesheet" type="text/css" href="style.css">

</head>
<body>        


  <script src="http://cdn.pubnub.com/pubnub-3.7.1.min.js"></script>
  <script src="http://www.parsecdn.com/js/parse-1.4.2.min.js"></script>  
  <script src="http://code.jquery.com/jquery-1.10.2.js"></script>
  <script src="http://code.jquery.com/ui/1.10.4/jquery-ui.js"></script>
  <script>
  Parse.initialize("8h7EqFtIOzritaD2lrssaAq0DdXpdwk83afH1KUS", "HEO3lR1rgo2NSW6rjiz6IzaNsFDIOJ8hL8QiAyGr");
  </script>

<!-- <a href="#" class="play"></a>
 -->
 <div id="controls">
  <button id="start">Start</button>
  <button id="stop">Stop</button>
  <button id="reset">Reset</button>
  <button id="#" onClick="saveToParse(SoundArray)">Save</button>
  <button id="#" onClick="Playback(SoundArray)">Play</button>


</div>

<script>
$(document).ready(function() {
  var icon = $('.play');
  icon.click(function() {
     icon.toggleClass('active');
     return false;
  });
});


function compare(a,b) {
  if (a.time < b.time)
    return -1;
  if (a.time > b.time)
    return 1;
  return 0;
}


function saveToParse(SoundArray) {
  if (record) return;
  console.log("Here");
  var ArrayObject = Parse.Object.extend("Sounds");
  var arrayObject = new ArrayObject();
  arrayObject.addUnique("SoundAndTime", SoundArray);
  arrayObject.save();
}

function Playback(SoundArray) {
  if (!record){
    startTime = Date.now();
  }

  function playItBack(idx){
    setTimeout(function(){
        var item = SoundArray[idx];
        if (idx >= SoundArray.length) { return; }
        console.log(item);

        while(Date.now() - startTime < item.time){
          playItBack(idx);
          return;
        }

        //console.log(item);
        playSound(item.key);
        playItBack(idx+1);
    }, 5);
  }
  playItBack(0);
}



</script>


<div id="timer">
  <span id="hours">00:</span>
  <span id="mins">00:</span>
  <span id="seconds">00:</span> 
  <span id="millis">00</span>  
</div>

<script>
var record = false;
var startTime = 0;
var hours =0;
var mins =0;
var seconds =0;
var millis = 0;



$('#start').click(function(){
  if (record) return;
  hours   = 0;
  mins    = 0;
  seconds = 0;
  $('#hours','#mins').html('00:');
  $('#seconds').html('00:');
  $('#millis').html('00');
  record  = true;
  startTime = Date.now();
  Playback(SoundArray);
  startTimer();
});

$('#stop').click(function(){
  clearTimeout(timex);
  record = false;
  SoundArray.sort(compare);
  console.log(SoundArray.sort(compare));
});

$('#reset').click(function(){
  clearTimeout(timex);
  record  = false;
  startTime = 0;
  hours   = 0;
  mins    = 0;
  seconds = 0;

  $('#hours','#mins').html('00:');
  $('#seconds').html('00:');
  $('#millis').html('00');

  SoundArray = [];
});

function startTimer(){
  timex = setTimeout(function(){
    millis++;
    if(millis > 99){
      seconds++;
      millis=0;
      if(seconds >59){
        seconds=0;
        mins++;
        if(mins>59) {
          mins=0;
          hours++;
          if(hours <10) {
            $("#hours").text('0'+hours+':')
          } 
          else 
            $("#hours").text(hours+':');
        }                   
        if(mins<10){                     
          $("#mins").text('0'+mins+':');
        }       
        else 
          $("#mins").text(mins+':');
      }    
      if(seconds <10) {
        $("#seconds").text('0'+seconds + ':');} 
      else {
        $("#seconds").text(seconds + ':');
      }
    }
    if(millis <10) {
      $("#millis").text('0'+millis);} 
    else {
      $("#millis").text(millis);
    }
    startTimer();
  },10);
}



var SoundMap = {}
</script>

<div class="key-wrapper" class="display-animation" style="text-align:center">
  <ul class="row">
    <button type="button" onclick="playSound('q')"> <li class="key k81">q</li></button>
    <button type="button" onclick="playSound('w')"> <li class="key k87">w</li></button>
    <button type="button" onclick="playSound('e')"><li class="key k69">e</li></button>
    <button type="button" onclick="playSound('r')"><li class="key k82">r</li></button>
    <button type="button" onclick="playSound('t')"><li class="key k84">t</li></button>
    <button type="button" onclick="playSound('y')"><li class="key k89">y</li></button>
    <button type="button" onclick="playSound('u')"><li class="key k85">u</li></button>
    <button type="button" onclick="playSound('i')"><li class="key k73">i</li></button>
    <button type="button" onclick="playSound('o')"><li class="key k79">o</li></button>
    <button type="button" onclick="playSound('p')"><li class="key k80">p</li></button>
  </ul>

  <ul class="row">
    <li class="key k65">a</li>
    <li class="key k83">s</li>
    <li class="key k68">d</li>
    <li class="key k70">f</li>
    <li class="key k71">g</li>
    <li class="key k72">h</li>
    <li class="key k74">j</li>
    <li class="key k75">k</li>
    <li class="key k76">l</li>
  </ul>

  <ul class="row">
    <li class="key k90">z</li>
    <li class="key k88">x</li>
    <li class="key k67">c</li>
    <li class="key k86">v</li>
    <li class="key k66">b</li>
    <li class="key k78">n</li>
    <li class="key k77">m</li>
  </ul>

  <ul class="row">
    <li class="key k32"></li>
  </ul>
</div>

<div id="audios">

</div>

<script>




</script>

<!--SCRIPT TO LIGHT UP BUTTONS AFTER BEING PUSHED -->
<script>

var SoundArray = [];

// 1) Click anwyere in the window bellow
// 2) Start pressing those keys

$(window).keydown(function(e) {
  key = (e.keyCode) ? e.keyCode : e.which;
  $('.key.k' + key).addClass('active');
  playSound(e.keyCode);
  if (record){
    var elapsed = Date.now() - startTime;
    SoundArray.push({key:key, time:elapsed});
    //console.log({key:key, time:elapsed});
  }
  
  if (record){
    var now = Date.now();
    var elapsed = now - startTime;
  } 
  else {
    //console.log(key);
  }
});

$(window).keyup(function(e) {
  key = (e.keyCode) ? e.keyCode : e.which;
  $('.key.k' + key).removeClass('active');
});
</script>

<!--SCRIPT TO PLAY SOUNDS ON BUTTON PRESS-->
<script>
var INSTR = {
  'q':"sounds/kick.wav",
  'w':"sounds/snare.wav", 
  'e':"sounds/clap.wav", 
  'r':"sounds/kick2.wav", 
  't':"sounds/snare2.wav", 
  'y':"sounds/closedhat.wav", 
  'u':"sounds/snap.wav", 
  'i':"sounds/clapsnare.wav", 
  'o':"sounds/openhat.wav", 
  'p':"sounds/",
  'a':"sounds/c-chord.mp3",
  's':"sounds/d-chord.mp3",
  'd':"sounds/organ_hi.mp3",
  'f':"sounds/organ_low.mp3",
  'g':"sounds/softmaj.mp3",
  'h':"sounds/softmin.mp3",
  'j':"sounds/chord3.wav",
  'k':"sounds/chord4.wav",
  'l':"sounds/oc4.wav",
  'z':"sounds/oc8.wav",
  'x':"sounds/",
  'c':"sounds/",
  'v':"sounds/",
  'b':"sounds/",
  'n':"sounds/",
  'm':"sounds/",
  ' ':""



 };

function playSound(sound){
  if (typeof(sound)=="number"){
    key = String.fromCharCode(sound).toLowerCase();
  } 
  else {
    key = sound;
  }

  new Audio(INSTR[key]).play();

}
</script>


<div class="container" style="  position: absolute;
  left: 35vw;
  top: 15vh;
  z-index: -1;">
  <div class="hexagon green"></div>
  <div class="hexagon red"></div>
  <div class="hexagon blue"></div>
  <div class="hexagon purple"></div>
  <div class="hexagon yellow"></div>
</div>


</body>
</html>